# pullover

这个项目是从 psycopg 里面，抽离出来的小工具。
起初的目的是用来对 python 代码中，格式化字符串为了兼顾代码语法正确，且字符串易读的同时，
生成的字符串在其它环境下也可以保留良好的结构和对齐。

比如，通过 python 生成 SQL 语句，要放到数据库环境下运行时，也可以保持良好的代码结构和对齐方式。

## 为什么不用 textwrap.dedent 方法？

因为 `textwrap.dedent` 方法只会处理统一的缩进方式，要么是空格，要么是 tab 。无法处理两种空格混用的情况。
不信的话，可以放2行文本：1行用空格开头，1行用 tab 开头。你看看 `textwrap.dedent` 方法会不会给你取消缩进。

另外，它也没有考虑缩进的删除，会导致制表符的巨大偏移。

举例来说，考虑如下2行（下划线代表空格，→代表制表符）：

```
__abc→def
__abc →def
```

这2行内容，在你缩进1个空格和2个空格的情况下，def 的对齐情况是完全不同的。
而 pullover 项目则在进行反缩进的时候，充分考虑到了我们平时都是用制表符来进行对齐的这一点。

## tabs 模式

既然用户在文本中，使用了制表符，那么，想必用户是非常希望制表符后面的内容，是可以跨行对齐的。
为此，pullover 的 tabs 模式，专门考虑了这一点，在删除缩进空白的时候，会以1个 tab stop 为1个整体进行删除。
当缩进不满足1个 tab stop ，而用户又使用了制表符的情况下，会保留剩余的，不满1个 tab stop 的缩进，以使后续的制表符内容保留对齐格式。

## spaces 模式

如果用户虽然使用了制表符，但是他仍旧希望可以有最大程度的缩进。
pullover 也提供了满足这一需求的工具： spaces 模式。

我们知道，制表符的具体可视长度，根据情况情况不同，有可能代表（在4空格代表1个 tab stop 的环境中）1、2、3、4个空格宽度。
spaces 模式会遍历整个文本，评估每个 tab 所展示的宽度，用对应数量的空格去替换。
这样一来，即使删除任意数量的缩进，也不会大幅打乱文本的结构和对齐方式。
缺点在于，在使用非等宽字体的环境中，原本可以用制表符进行对齐的文本，看起来会没有那么整齐，甚至出现偏移。

## 待办

目前代码还没有从 psycopg 里面剥离出来。同时代码还需要进行整理，删除多余代码和注释。
还需要补充使用案例，添加测试，抽象调用方法等。
文档还需要把具体的使用方法补上。
